<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Notification Bell</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Notification CSS -->
    <link rel="stylesheet" th:href="@{/css/notification.css}">
    
    <style>
        body {
            padding: 50px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        .header-mock {
            background: #333;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .header-actions {
            display: flex;
            gap: 20px;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîî Test Notification Bell</h1>
        <hr>
        
        <!-- Authentication Status -->
        <div class="test-section">
            <h3>1. Authentication Status</h3>
            <p>
                <strong>Authenticated:</strong> 
                <span class="status-badge" th:classappend="${isAuthenticated} ? 'status-success' : 'status-error'"
                      th:text="${isAuthenticated} ? 'YES ‚úì' : 'NO ‚úó'">NO</span>
            </p>
            <p th:if="${isAuthenticated}">
                <strong>Username:</strong> <span th:text="${username}">N/A</span>
            </p>
            <p th:unless="${isAuthenticated}">
                <a href="/login" class="btn btn-primary">ƒêƒÉng nh·∫≠p ƒë·ªÉ test</a>
            </p>
        </div>
        
        <!-- Notification Bell Test -->
        <div class="test-section">
            <h3>2. Notification Bell (Using Fragment)</h3>
            <p>Notification bell s·∫Ω ch·ªâ hi·ªÉn th·ªã khi ƒë√£ ƒëƒÉng nh·∫≠p:</p>
            
            <!-- Mock header -->
            <div class="header-mock">
                <div>TULIP SHOP</div>
                <div class="header-actions">
                    <span>Search</span>
                    
                    <!-- Notification Bell Fragment -->
                    <div sec:authorize="isAuthenticated()">
                        <div th:replace="~{fragments/notification :: notification-bell}"></div>
                    </div>
                    
                    <span>Cart</span>
                </div>
            </div>
            
            <div sec:authorize="!isAuthenticated()" class="alert alert-warning">
                ‚ö†Ô∏è B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p. Notification bell s·∫Ω kh√¥ng hi·ªÉn th·ªã.
            </div>
            
            <div sec:authorize="isAuthenticated()" class="alert alert-success">
                ‚úì B·∫°n ƒë√£ ƒëƒÉng nh·∫≠p. Notification bell ph·∫£i hi·ªÉn th·ªã ·ªü tr√™n.
            </div>
        </div>
        
        <!-- Direct HTML Test -->
        <div class="test-section">
            <h3>3. Direct HTML Test (Without Fragment)</h3>
            <p>Test tr·ª±c ti·∫øp HTML kh√¥ng qua fragment:</p>
            
            <div class="dropdown" id="testNotificationDropdown">
                <a class="nav-link position-relative notification-bell" 
                   href="#" 
                   role="button" 
                   data-bs-toggle="dropdown">
                    <i class="bi bi-bell"></i>
                    <span class="notification-badge" style="display: inline-block;">5</span>
                </a>
                <div class="dropdown-menu dropdown-menu-end notification-dropdown">
                    <div class="notification-header">
                        <h6>Th√¥ng b√°o Test</h6>
                    </div>
                    <div class="notification-list">
                        <a href="#" class="notification-item unread">
                            <div class="notification-icon">
                                <i class="bi bi-box-seam"></i>
                            </div>
                            <div class="notification-content">
                                <div class="notification-title">Test Notification</div>
                                <div class="notification-text">This is a test notification</div>
                                <div class="notification-time">Just now</div>
                            </div>
                            <span class="unread-dot"></span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Console Check -->
        <div class="test-section">
            <h3>4. Console Check</h3>
            <p>M·ªü Console (F12) v√† ki·ªÉm tra:</p>
            <ul>
                <li>C√≥ th·∫•y log "üîî Initializing Notification Manager..." kh√¥ng?</li>
                <li>C√≥ th·∫•y log "‚úÖ WebSocket connected" kh√¥ng?</li>
                <li>C√≥ l·ªói g√¨ trong Console kh√¥ng?</li>
            </ul>
            <button class="btn btn-info" onclick="checkConsole()">Check Console</button>
        </div>
        
        <!-- Files Check -->
        <div class="test-section">
            <h3>5. Files Check</h3>
            <div id="filesCheck">
                <p>Checking files...</p>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- SockJS & STOMP -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <!-- Notification JS -->
    <script th:src="@{/js/notification.js}"></script>
    
    <script>
        function checkConsole() {
            console.log('=== NOTIFICATION DEBUG ===');
            console.log('1. NotificationManager exists:', typeof window.notificationManager !== 'undefined');
            console.log('2. Notification dropdown element:', document.getElementById('notificationDropdown'));
            console.log('3. Test dropdown element:', document.getElementById('testNotificationDropdown'));
            console.log('4. Notification CSS loaded:', !!document.querySelector('link[href*="notification.css"]'));
            console.log('5. Bootstrap Icons loaded:', !!document.querySelector('link[href*="bootstrap-icons"]'));
            console.log('6. SockJS loaded:', typeof SockJS !== 'undefined');
            console.log('7. Stomp loaded:', typeof Stomp !== 'undefined');
            console.log('8. Access Token:', getCookie('accessToken') ? 'Found' : 'Not found');
            console.log('========================');
            alert('Check Console (F12) for debug info');
        }
        
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }
        
        // Check files on load
        window.addEventListener('load', function() {
            const checks = {
                'notification.css': !!document.querySelector('link[href*="notification.css"]'),
                'notification.js': typeof window.notificationManager !== 'undefined',
                'Bootstrap Icons': !!document.querySelector('link[href*="bootstrap-icons"]'),
                'SockJS': typeof SockJS !== 'undefined',
                'STOMP': typeof Stomp !== 'undefined',
                'jQuery': typeof jQuery !== 'undefined'
            };
            
            let html = '<ul>';
            for (const [name, loaded] of Object.entries(checks)) {
                const status = loaded ? '‚úì' : '‚úó';
                const className = loaded ? 'text-success' : 'text-danger';
                html += `<li class="${className}"><strong>${status} ${name}</strong></li>`;
            }
            html += '</ul>';
            
            document.getElementById('filesCheck').innerHTML = html;
        });
    </script>
</body>
</html>

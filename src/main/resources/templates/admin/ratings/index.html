<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" th:href="@{/css/admin-ratings.css}">
</head>
<body>

<div th:fragment="content">
    <div class="space-y-6">
        <!-- Page Header -->
        <div class="flex justify-between items-end">
            <div>
                <h1 class="text-4xl font-black italic tracking-tighter mb-2 font-condensed">QUẢN LÝ ĐÁNH GIÁ</h1>
                <p class="text-sm text-gray-500 uppercase tracking-widest">Rating Management</p>
            </div>
            <div class="flex items-center gap-3">
                <div class="bg-white border border-gray-200 rounded-lg px-4 py-2">
                    <span class="text-xs text-gray-500 uppercase tracking-wider">Tổng đánh giá:</span>
                    <span class="text-xl font-black ml-2" id="totalRatings">0</span>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="bg-white border border-gray-200 rounded-lg p-4">
            <div class="flex flex-wrap gap-4 items-end">
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-xs font-bold uppercase tracking-wider text-gray-500 mb-2">Lọc theo số sao</label>
                    <select id="filterStars" onchange="loadRatings()" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium outline-none focus:ring-2 focus:ring-black">
                        <option value="">Tất cả</option>
                        <option value="5">⭐⭐⭐⭐⭐ (5 sao)</option>
                        <option value="4">⭐⭐⭐⭐ (4 sao)</option>
                        <option value="3">⭐⭐⭐ (3 sao)</option>
                        <option value="2">⭐⭐ (2 sao)</option>
                        <option value="1">⭐ (1 sao)</option>
                    </select>
                </div>
                <div class="flex-1 min-w-[200px]">
                    <label class="block text-xs font-bold uppercase tracking-wider text-gray-500 mb-2">Trạng thái phản hồi</label>
                    <select id="filterReply" onchange="loadRatings()" 
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium outline-none focus:ring-2 focus:ring-black">
                        <option value="">Tất cả</option>
                        <option value="false">Chờ phản hồi</option>
                        <option value="true">Đã phản hồi</option>
                    </select>
                </div>
                <div>
                    <button onclick="resetFilters()" 
                            class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors">
                        <i data-lucide="rotate-ccw" class="w-4 h-4 inline-block mr-1"></i>
                        Đặt lại
                    </button>
                </div>
            </div>
        </div>

        <!-- Ratings Table -->
        <div class="bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm">
            <table class="w-full">
                <thead class="bg-gray-50 border-b border-gray-200">
                    <tr>
                        <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-500">Khách hàng</th>
                        <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-500">Sản phẩm</th>
                        <th class="px-6 py-4 text-center text-xs font-bold uppercase tracking-wider text-gray-500">Đánh giá</th>
                        <th class="px-6 py-4 text-left text-xs font-bold uppercase tracking-wider text-gray-500">Nội dung</th>
                        <th class="px-6 py-4 text-center text-xs font-bold uppercase tracking-wider text-gray-500">Điểm chất lượng</th>
                        <th class="px-6 py-4 text-center text-xs font-bold uppercase tracking-wider text-gray-500">Trạng thái</th>
                        <th class="px-6 py-4 text-center text-xs font-bold uppercase tracking-wider text-gray-500">Hành động</th>
                    </tr>
                </thead>
                <tbody id="ratingsTableBody">
                    <tr>
                        <td colspan="7" class="p-20 text-center">
                            <div class="text-gray-400">
                                <i data-lucide="loader" class="w-12 h-12 mx-auto mb-3 opacity-50 animate-spin"></i>
                                <p class="text-sm font-medium">Đang tải dữ liệu...</p>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="flex justify-between items-center">
            <div class="text-sm text-gray-500">
                Hiển thị <strong id="showingFrom">0</strong> - <strong id="showingTo">0</strong> 
                trong tổng số <strong id="showingTotal">0</strong> đánh giá
            </div>
            <div class="flex gap-2" id="pagination">
                <!-- Pagination will be generated by JS -->
            </div>
        </div>
    </div>

    <!-- Reply Modal -->
    <div id="replyModal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-2xl font-black font-condensed">PHẢN HỒI ĐÁNH GIÁ</h3>
                        <p class="text-sm text-gray-500 mt-1">Trả lời đánh giá của khách hàng</p>
                    </div>
                    <button onclick="closeReplyModal()" class="text-gray-400 hover:text-gray-600">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-xs font-bold uppercase tracking-wider text-gray-500 mb-2">Đánh giá của khách hàng:</label>
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200" id="originalReview">
                        <!-- Original review content -->
                    </div>
                </div>
                
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-xs font-bold uppercase tracking-wider text-gray-500">Nội dung phản hồi:</label>
                        <button type="button" onclick="generateAISuggestions()" id="aiSuggestBtn"
                                class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg text-xs font-bold hover:from-purple-700 hover:to-blue-700 transition-all shadow-md hover:shadow-lg">
                            <i data-lucide="sparkles" class="w-4 h-4"></i>
                            <span id="aiSuggestBtnText">Dùng AI gợi ý</span>
                        </button>
                    </div>
                    
                    <!-- AI Suggestions Container -->
                    <div id="aiSuggestions" class="hidden mb-3 space-y-2">
                        <div class="text-xs text-gray-600 font-medium mb-2">
                            <i data-lucide="lightbulb" class="w-3 h-3 inline-block"></i>
                            Chọn một gợi ý để điền vào ô phản hồi:
                        </div>
                        <div id="aiSuggestionsContent" class="space-y-2">
                            <!-- AI suggestions will be rendered here -->
                        </div>
                    </div>
                    
                    <textarea id="replyContent" rows="4" 
                              placeholder="Nhập nội dung phản hồi của bạn..."
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg text-sm outline-none focus:ring-2 focus:ring-black resize-none"></textarea>
                </div>
            </div>
            
            <div class="p-6 border-t border-gray-200 flex justify-end gap-3">
                <button onclick="closeReplyModal()" 
                        class="px-6 py-2 border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors">
                    Hủy
                </button>
                <button onclick="submitReply()" 
                        class="px-6 py-2 bg-black text-white rounded-lg text-sm font-bold hover:bg-gray-800 transition-colors">
                    <i data-lucide="send" class="w-4 h-4 inline-block mr-1"></i>
                    Gửi phản hồi
                </button>
            </div>
        </div>
    </div>

    <!-- Load JavaScript -->
    <script th:src="@{/js/admin-ratings.js}"></script>
    <script>
        // Initialize icons after page load
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    </script>
</div>

</body>
</html>
